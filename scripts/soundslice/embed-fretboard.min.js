var Bw = [null, [76, 69, 62, 55], [79, 72, 65, 59], [81, 74, 67, 60], [83, 76, 69, 62], [84, 77, 71, 64], [86, 79, 72, 65], [88, 81, 74, 67]]
  , Cw = [2, 4, 5, 7];
function Dw(a) {
    a.G = Math.floor((a.height - 2 * a.D) / (a.C - 1))
}
function Ew(a, b, c) {
    var d = a.g;
    b = (a.A[b] + 3 + a.A[b + 1]) / 2;
    a.m ? Kd(d, a.width - b, c, 4, !1) : Kd(d, b, c, 4, !1)
}
class Fw {
    constructor(a, b, c, d, e) {
        this.g = a;
        this.j = b;
        this.M = c;
        this.N = d;
        this.H = e;
        this.m = !1;
        this.C = 6;
        this.B = 0;
        this.I = 12;
        this.K = null;
        this.D = e ? 15 : 12;
        this.G = 0;
        this.A = [];
        this.height = this.width = 0
    }
}
function Gw(a) {
    if (a.isActive) {
        var b = a.K
          , c = a.g
          , d = c.B
          , e = Ft(d)
          , f = c.D;
        if (e || f.g !== a.G)
            if (b.length = 0,
            e)
                for (a = d.j.g; a !== d.g.g + 1; a++)
                    b.push(c.g.B[a].L.P),
                    b.push(a === d.j.g ? Rp(d.j, c.g) : 0),
                    b.push(a === d.g.g ? Rp(d.g, c.g) : 1);
            else
                b.push(Sp(f, c.g).L.P),
                b.push(0),
                b.push(1),
                a.G = f.g
    }
}
function Hw(a) {
    a.isActive && !a.C && (requestAnimationFrame(a.R),
    a.C = !0)
}
function Iw(a) {
    var b = Ia(a.m).width;
    if (a.width !== b) {
        a.width = b;
        var c = a.j;
        if (b !== c.width || 135 !== c.height)
            b !== c.width && (Mc(c.g, b),
            Mc(c.j, b)),
            135 !== c.height && (Uc(c.g, 135),
            Uc(c.j, 135),
            Va(c.M, 135)),
            c.width = b,
            c.height = 135,
            Dw(c)
    }
    Jw(a);
    Hw(a)
}
function Jw(a) {
    a.isActive && !a.B && (requestAnimationFrame(a.S),
    a.B = !0)
}
function Kw(a) {
    for (var b = null === a.track, c = a.A, d = b ? null : a.track.index, e = b ? 0 : d + 1, f = a.g.A.j, g = f.length, h, k; e !== 2 * g; e++)
        if (h = e % g,
        k = f[h],
        c && k.ya || !c && k.C) {
            if (b || h !== d)
                if (b = k,
                a.track !== b) {
                    a.track = b;
                    a.I.innerHTML = Pa(b.name);
                    d = a.j;
                    k = a.A ? 4 : b.D;
                    c = b.G;
                    if (a.A)
                        e = 30;
                    else {
                        e = Math;
                        f = e.max;
                        g = b.G;
                        h = void 0;
                        var l = a.g.g;
                        var m = b.index
                          , p = 0;
                        for (h of Lm(l, m))
                            (l = h.va) && l > p && (p = l);
                        e = f.call(e, g + p + 1, 10)
                    }
                    b = b.wa;
                    d.C = k;
                    d.B = c;
                    d.I = e;
                    d.K = b;
                    Dw(d);
                    Gw(a);
                    Jw(a);
                    Hw(a)
                }
            break
        }
}
function Lw(a) {
    if (!a.isActive) {
        var b = a.g;
        a.isActive = !0;
        null === a.track && Kw(a);
        b.assign([67, 51, 25], a.O, [14, 53], a.N);
        xa(a.m, "active");
        Iw(a)
    }
}
function Mw(a) {
    if (a.isActive) {
        var b = a.g;
        a.isActive = !1;
        lu(b, [67, 51, 25], a.O);
        lu(b, [14, 53], a.N);
        E(a.m, "active")
    }
}
function Nw(a, b, c, d) {
    var e = a.g.A
      , f = a.M;
    if (a.A) {
        var g = a.H;
        var h = b.I.P;
        var k = -1;
        for (var l = b.F, m = l.J.track.index, p = e.g, n = l.J.L.P, q = l.m, r = null, v, t, w, u; 0 <= n && -1 === k; ) {
            v = p[n].g[m].g;
            for (t = v.length; t--; )
                for (w = v[t],
                u = w.length; u--; )
                    l = w[u],
                    null === l.Y || q && !me(q, l.m) || r && !je(l.m, r) || (k = l.Y[0],
                    r = l.m);
            q = null;
            n--
        }
        l = Bw[-1 === k ? 1 : k];
        for (m = k = 0; 4 !== m; m++)
            if (h >= l[m]) {
                k = m;
                break
            }
        h -= Bw[1][k];
        g.ia = k;
        g.va = h;
        h = a.H.va;
        g = a.H.ia
    } else
        h = b.va,
        g = b.ia;
    k = 50 * g + h;
    -1 === rb(f, k) && (f.push(k),
    f = a.j,
    a = Pi(b) ? "X" : b.G.g.toString(),
    k = c ? -3 * qj(b, e, d) / 5 + 1 : -1,
    0 > h || (b = f.j,
    c = f.width,
    l = f.H,
    d = f.m,
    m = f.A,
    e = f.D + g * f.G,
    0 === h ? g = 20 : (h += f.B,
    g = l ? m[h] + 8 : (m[h] + 3 + m[h - 1]) / 2),
    -1 === k ? L(b, "rgba(0, 0, 0, 0.5)") : L(b, "rgba(243, 164, 44, " + Math.round(100 * k) / 100 + ")"),
    h = g,
    d ? Kd(b, c - h, e, 12, !1) : Kd(b, h, e, 12, !1),
    L(b, "#fff"),
    f = g - f.N.width(11, 2, a, !0) / 2,
    e += 2.75,
    d ? kd(b, a, c - f - gd(b, a), e) : kd(b, a, f, e)))
}
class Ow {
    constructor(a, b) {
        this.m = z("fretboard");
        this.I = z("fretboard-nut");
        this.A = a;
        var c = this.g = b.g;
        this.D = !1;
        this.K = [];
        this.M = [];
        this.T = [];
        this.U = [];
        this.H = {};
        this.track = null;
        this.isActive = !1;
        this.G = -1;
        this.j = new Fw(new Qd(z("fretback"),c.K),new Qd(z("fretfront"),c.K),z("fretcapo"),b.g.S,a);
        this.width = 0;
        this.C = this.B = !1;
        this.S = ()=>{
            if (null !== this.track) {
                var d = this.j, e = d.g, f = d.M, g = d.width, h = d.height, k = d.A, l = d.H, m = d.m, p = d.D, n = d.C, q = d.B, r = d.I, v = d.K, t = d.G, w = (g - 20 - 20) / (1 - 1 / Math.pow(2, (r + 1) / 12)), u;
                L(e, "#626262");
                N(e, 0, 0, g, h);
                for (u = k.length = 0; u !== r + 2; u++)
                    k.push(40 + w - w / Math.pow(2, u / 12));
                if (l)
                    for (L(e, "#868686"),
                    u = Cw.length; u--; ) {
                        w = e;
                        var x = k[Cw[u]]
                          , y = h;
                        m ? N(w, g - x - 16, 0, 16, y) : N(w, x, 0, 16, y)
                    }
                else
                    for (L(e, "#868686"),
                    u = 1; u !== r + 1; u++)
                        w = e,
                        x = k[u],
                        y = h,
                        m ? N(w, g - x - 3, 0, 3, y) : N(w, x, 0, 3, y);
                l || (L(e, "#868686"),
                Ew(d, 2, h / 2),
                Ew(d, 4, h / 2),
                5 < r && (Ew(d, 6, h / 2),
                7 < r && (Ew(d, 8, h / 2),
                10 < r && (Ew(d, 11, h / 3),
                Ew(d, 11, 2 * h / 3),
                13 < r && (Ew(d, 14, h / 2),
                15 < r && (Ew(d, 16, h / 2),
                17 < r && (Ew(d, 18, h / 2),
                20 < r && (Ew(d, 20, h / 2),
                23 < r && (Ew(d, 23, h / 3),
                Ew(d, 23, 2 * h / 3))))))))));
                q ? (ab(f, "block"),
                Sa(f, (m ? g - k[q] : k[q] - 21) - h),
                f.textContent = "Capo " + q) : ab(f, "none");
                L(e, "#bdbdbd");
                for (u = n; u--; )
                    N(e, 0, p + u * t, g, 2 * (u + n) / (2 * n));
                if (!l && null !== v)
                    for (L(e, "#626262"),
                    u = v.length; u--; )
                        if (h = v[u])
                            d = e,
                            f = p + (u - .5) * t,
                            h = k[h],
                            l = t + 2 + (u === n - 1 ? t : 0),
                            m ? N(d, g - h, f, h, l) : N(d, 0, f, h, l)
            }
            this.B = !1
        }
        ;
        this.R = ()=>{
            if (null !== this.track) {
                var d = this.g
                  , e = d.A
                  , f = this.K
                  , g = this.T
                  , h = this.U
                  , k = this.track
                  , l = d.D
                  , m = Mp(l) ? Sp(l, d.g).L.P : null;
                d = Rp(l, d.g);
                var p, n, q;
                this.M.length = 0;
                g.length = 0;
                l = h.length = 0;
                for (p = f.length; l < p; l += 3) {
                    var r = e.g[f[l]];
                    var v = f[l + 1];
                    var t = f[l + 2];
                    var w = r.g[k.index].g;
                    for (n = w.length; n--; ) {
                        var u = w[n];
                        for (q = u.length; q--; ) {
                            var x = u[q];
                            var y = x.D / r.m.W;
                            var A = (x.D + x.N) / r.m.W;
                            if (!(0 !== v && v >= A || 1 !== t && t <= y)) {
                                var B = f[l] === m && y <= d && A >= d;
                                for (A = x.g.length; A--; )
                                    y = x.g[A],
                                    B ? g.push(y) : h.push(y)
                            }
                        }
                    }
                }
                e = this.j;
                f = e.j;
                Jd(f, 0, 0, e.width, e.height);
                Zc(f, 11, 2, !0);
                f.g.strokeStyle = "transparent";
                for (l = g.length; l--; )
                    Nw(this, g[l], !0, d);
                for (l = h.length; l--; )
                    Nw(this, h[l], !1, d)
            }
            this.C = !1
        }
        ;
        this.O = ()=>{
            Ft(this.g.B) || Gw(this);
            Hw(this)
        }
        ;
        this.N = ()=>{
            this.G = -1;
            Gw(this);
            Hw(this)
        }
        ;
        qs(c, [195], ()=>{
            Iw(this)
        }
        );
        c.assign([25], ()=>{
            Jw(this)
        }
        );
        Bb(this.I, ()=>{
            Kw(this)
        }
        );
        Bb(z("toggle-hand"), ()=>{
            var d = !this.D;
            this.D !== d && (F(this.m, "lefty", d),
            this.D = d,
            this.j.m = d,
            Jw(this),
            Hw(this))
        }
        )
    }
}
(()=>{
    var a = soundslice.webui
      , b = null
      , c = null;
    a.g.assign([111], d=>{
        d.data ? (c || (c = new Ow(!0,a)),
        Lw(c)) : (b || (b = new Ow(!1,a)),
        Lw(b))
    }
    , [112], d=>{
        d.data ? c && Mw(c) : b && Mw(b)
    }
    )
}
)();
